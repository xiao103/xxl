<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å•è¯æ¶ˆæ¶ˆä¹</title>
    <!-- å¼•å…¥SheetJSåº“ç”¨äºExcelè§£æ -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <!-- å¼•å…¥confettiåº“ç”¨äºæ¸¸æˆèƒœåˆ©æ•ˆæœ -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- å¼•å…¥howler.jsç”¨äºéŸ³æ•ˆ -->
    <script src="https://cdn.jsdelivr.net/npm/howler@2.2.3/dist/howler.min.js"></script>
    <style>
        /* æ–°é…è‰²æ–¹æ¡ˆ */
        :root {
            --primary: #34314c;    /* æ·±è“ç´« - ç”¨äºæ–‡å­—å’Œå¼ºè°ƒ */
            --secondary: #47b8e0;  /* äº®è“è‰² - ç”¨äºæŒ‰é’®å’Œäº¤äº’å…ƒç´  */
            --accent: #ff7473;     /* çŠç‘šç²‰ - ç”¨äºç‚¹ç¼€å’Œé«˜äº® */
            --light: #ffc952;      /* é‡‘é»„è‰² - ç”¨äºèƒŒæ™¯å’Œäº®éƒ¨ */
            
            /* å¡ç‰‡ç³–æœè‰²ä¿æŒä¸å˜ */
            --candy-red: #FF6B6B;
            --candy-orange: #FFA36B;
            --candy-yellow: #FFD56B;
            --candy-green: #A3E06B;
            --candy-mint: #6BE0A3;
            --candy-blue: #6BA3E0;
            --candy-purple: #A36BE0;
            --candy-pink: #E06BA3;
        }

<button id="menu-toggle" class="menu-toggle"><i class="fas fa-bars"></i></button>
      <div class="mobile-drawer" id="mobile-drawer">
      <!-- å†…å®¹å’Œå·¦ä¾§é¢æ¿ä¸€æ ·ï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶ left-panel çš„å†…å®¹è¿‡æ¥ï¼ˆæ³¨æ„ id è¦åŠ  -m åŒºåˆ†ï¼‰ -->
      </div>

        
        body {
            font-family: 'Comic Sans MS', 'Marker Felt', 'åæ–‡ç¥ç€', cursive, sans-serif;
            background-color: var(--light);
            margin: 0;
            padding: 10px;
            color: var(--primary);
            min-height: 100vh;
            background-image:
                radial-gradient(circle at 10% 20%, rgba(255, 116, 115, 0.2) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(71, 184, 224, 0.2) 0%, transparent 20%);
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 10px 25px rgba(52, 49, 76, 0.2);
            border: 4px solid var(--accent);
            position: relative;
            overflow: hidden;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }

        .container::before {
            content: "";
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            border: 3px dashed var(--secondary);
            border-radius: 25px;
            pointer-events: none;
            animation: rotate 60s linear infinite;
        }

        @keyframes rotate {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 0 rgba(255, 116, 115, 0.3);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            display: inline-block;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            padding: 0 15px;
            grid-column: 1 / -1;
            letter-spacing: 1px;
        }

        h1:hover {
            transform: translateX(-50%) scale(1.05);
            text-shadow: 3px 3px 0 rgba(255, 116, 115, 0.3);
        }

        h1::after {
            content: "";
            position: absolute;
            bottom: 3px;
            left: 20%;
            width: 60%;
            height: 5px;
            background: linear-gradient(90deg, var(--accent), var(--light), var(--secondary), var(--primary));
            border-radius: 3px;
            z-index: -1;
            opacity: 0.5;
        }

        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            border: 3px solid var(--secondary);
            position: relative;
            overflow: hidden;
        }

        .left-panel::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2347b8e0' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.3;
            z-index: 0;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .control-group label {
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        label {
            font-weight: bold;
            color: var(--primary);
            font-size: 1em;
            text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.8);
        }

        input[type="range"] {
            width: 100%;
            height: 20px;
            -webkit-appearance: none;
            background: linear-gradient(to right, var(--accent), var(--light), var(--secondary), var(--primary));
            border-radius: 10px;
            outline: none;
            box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);
            border: 2px solid white;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            background: white;
            border-radius: 50%;
            border: 3px solid var(--primary);
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
            transition: all 0.2s;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .word-count {
            font-weight: bold;
            color: var(--primary);
            font-size: 1.3em;
            background-color: white;
            padding: 3px 10px;
            border-radius: 10px;
            border: 2px solid var(--primary);
            box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);
            margin: 5px auto;
            display: inline-block;
        }

        button {
            background: linear-gradient(145deg, var(--secondary), var(--primary));
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 40px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
            transition: all 0.3s;
            box-shadow: 0 4px 0 var(--primary), 0 5px 10px rgba(52, 49, 76, 0.2);
            position: relative;
            overflow: hidden;
            z-index: 1;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.2);
            width: 100%;
            margin: 3px 0;
        }

        button::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, var(--primary), var(--secondary));
            opacity: 0;
            z-index: -1;
            transition: opacity 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 var(--primary), 0 8px 15px rgba(52, 49, 76, 0.3);
        }

        button:hover::before {
            opacity: 1;
        }

        button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 0 var(--primary), 0 3px 5px rgba(52, 49, 76, 0.2);
        }

        .timer {
            text-align: center;
            font-size: 1.5em;
            color: var(--primary);
            font-weight: bold;
            background-color: white;
            padding: 10px;
            border-radius: 40px;
            border: 2px solid var(--secondary);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            margin: 8px 0;
        }

        .timer::before {
            content: "â±";
            margin-right: 8px;
            color: var(--secondary);
        }

        .word-panel {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
            align-content: start;
            padding: 15px;
            -webkit-overflow-scrolling: touch;
        }

        /* å¡ç‰‡ä¿æŒç³–æœè‰² */
        .word-card {
            background: var(--candy-blue);
            border-radius: 15px;
            height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            border: 3px solid white;
            color: white;
            text-align: center;
            padding: 8px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .word-card:nth-child(8n + 1) {
            background: var(--candy-red);
        }

        .word-card:nth-child(8n + 2) {
            background: var(--candy-orange);
        }

        .word-card:nth-child(8n + 3) {
            background: var(--candy-yellow);
            color: #5A3D5C;
            text-shadow: none;
        }

        .word-card:nth-child(8n + 4) {
            background: var(--candy-green);
        }

        .word-card:nth-child(8n + 5) {
            background: var(--candy-mint);
        }

        .word-card:nth-child(8n + 6) {
            background: var(--candy-blue);
        }

        .word-card:nth-child(8n + 7) {
            background: var(--candy-purple);
        }

        .word-card:nth-child(8n + 8) {
            background: var(--candy-pink);
        }

        .word-card:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            z-index: 2;
        }

        .word-card::before {
            content: "";
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            border: 2px dashed white;
            border-radius: 20px;
            opacity: 0;
            transition: all 0.3s;
        }

        .word-card:hover::before {
            opacity: 0.6;
            animation: rotate 10s linear infinite;
        }

        .word-card.flipped {
            background: linear-gradient(145deg, #FFD6E7, #FFC0CB) !important;
            color: transparent !important;
            transform: rotateY(180deg);
        }

        .word-card.matched {
            animation: matchAnimation 0.5s forwards;
            pointer-events: none;
        }

        @keyframes matchAnimation {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            50% {
                transform: scale(1.1);
                opacity: 0.8;
                background: white;
            }

            100% {
                transform: scale(0);
                opacity: 0;
            }
        }

        .word-card::after {
            content: '?';
            position: absolute;
            color: white;
            font-size: 2em;
            opacity: 0;
            transition: all 0.3s;
            text-shadow: 2px 2px 0 rgba(0, 0, 0, 0.2);
        }

        .word-card.flipped::after {
            opacity: 1;
        }

        .file-input {
            display: none;
        }

        .builtin-wordbanks {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 10px 0;
        }

        .builtin-wordbank {
            background: linear-gradient(145deg, var(--secondary), var(--primary));
            padding: 10px 14px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s;
            box-shadow: 0 3px 0 var(--primary), 0 4px 8px rgba(52, 49, 76, 0.2);
            border: 2px solid white;
            color: white;
            font-weight: bold;
            position: relative;
            overflow: hidden;
            text-align: center;
        }

        .builtin-wordbank::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .builtin-wordbank:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 0 var(--primary), 0 7px 12px rgba(52, 49, 76, 0.3);
        }

        .builtin-wordbank:hover::before {
            opacity: 1;
        }

        .builtin-wordbank:active {
            transform: translateY(1px);
            box-shadow: 0 2px 0 var(--primary), 0 3px 5px rgba(52, 49, 76, 0.2);
        }

        .volume-control {
            position: fixed;
            bottom: 15px;
            right: 15px;
            background-color: white;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            z-index: 100;
            border: 2px solid var(--primary);
        }

        .volume-control i {
            font-size: 20px;
            color: var(--primary);
        }

        /* å°å±å¹•è®¾å¤‡ï¼ˆå¦‚æ‰‹æœºï¼‰ç«–å±æ¨¡å¼ */
        @media (max-width: 768px) and (orientation: portrait) {
            body {
                padding: 8px;
            }
            
            .container {
                grid-template-columns: 1fr;
                padding: 10px;
                gap: 12px;
                max-height: calc(100vh - 20px);
                overflow-y: auto;
                border-radius: 15px;
            }

            .left-panel {
                padding: 12px;
                gap: 12px;
            }

            .control-group {
                gap: 8px;
            }

            .word-panel {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                padding: 10px;
                max-height: 55vh;
                overflow-y: auto;
            }
            
            .word-card {
                height: 70px;
                font-size: 1em;
                border-radius: 12px;
            }

            h1 {
                font-size: 1.8em;
                margin-bottom: 10px;
            }

            button, .builtin-wordbank {
                padding: 10px 12px;
                font-size: 0.9em;
            }

            .timer {
                font-size: 1.2em;
                padding: 8px;
            }
            
            .volume-control {
                width: 40px;
                height: 40px;
                bottom: 10px;
                right: 10px;
            }
            
            .volume-control i {
                font-size: 18px;
            }
        }

        /* æ¨ªå±æ ·å¼ */
        @media (max-width: 768px) and (orientation: landscape) {
            .container {
                grid-template-columns: 220px 1fr;
                gap: 15px;
                padding: 12px;
            }
            
            .word-panel {
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
            }
            
            .word-card {
                height: 70px;
                font-size: 1em;
            }
            
            h1 {
                font-size: 2em;
            }
        }

        /* ä¸­ç­‰å±å¹•è®¾å¤‡ï¼ˆå¦‚å¹³æ¿ï¼‰ */
        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                grid-template-columns: 250px 1fr;
                padding: 15px;
            }

            .word-panel {
                grid-template-columns: repeat(3, 1fr);
            }

            h1 {
                font-size: 2.5em;
            }
        }

        /* å®½å±æ˜¾ç¤ºå™¨ */
        @media (min-width: 1600px) {
            .container {
                max-width: 1400px;
            }
            
            .word-panel {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
        }


.menu-toggle {
  display: none;
  position: fixed;
  top: 12px;
  left: 12px;
  z-index: 101;
  background: var(--secondary);
  color: white;
  border: none;
  border-radius: 50%;
  width: 42px; height: 42px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.12);
  align-items: center;
  justify-content: center;
}
@media (max-width: 768px) {
  .menu-toggle { display: flex; }
  .left-panel { display: none !important; }
  .mobile-drawer {
    display: block !important;
    position: fixed;
    left: 0; top: 0; bottom: 0;
    width: 75vw;
    z-index: 200;
    background: white;
    transform: translateX(-100%);
    box-shadow: 4px 0 16px rgba(52,49,76,0.13);
    transition: transform 0.3s;
    overflow-y: auto;
    padding-top: 42px;
    border-radius: 0 18px 18px 0;
  }
  .mobile-drawer.open { transform: translateX(0); }
  .word-panel { grid-template-columns: repeat(2, 1fr); gap: 7px; padding: 7px; max-height: 65vh; overflow-y: auto; }
  .word-card { height: clamp(54px,18vw,70px); font-size: clamp(0.9em, 2.8vw,1.03em); border-radius: 10px; padding: 4px; }
  .volume-control { width: 36px; height: 36px; bottom: 5px; right: 5px; opacity: 0.65; }
}
@media (max-width: 480px) {
  .word-panel { grid-template-columns: repeat(1,1fr); }
  .word-card { height: 50px; font-size: 1em; }
}    
    </style>
    <!-- ä½¿ç”¨Font Awesomeå›¾æ ‡ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="container">
        <h1 id="game-title">å•è¯æ¶ˆæ¶ˆä¹</h1>

        <div class="left-panel">
            <div class="control-group">
                <label for="word-count">å•è¯å¯¹æ•°</label>
                <input type="range" id="word-count" min="5" max="50" value="10">
                <span class="word-count" id="word-count-display">10</span>
            </div>

            <button id="start-btn"><i class="fas fa-play"></i> å¼€å§‹æ¸¸æˆ</button>
            
            <div class="timer" id="timer">è€—æ—¶: 0ç§’</div>

            <button id="import-btn"><i class="fas fa-file-import"></i> å¯¼å…¥è¯è¡¨</button>
            <input type="file" id="file-input" class="file-input" accept=".xlsx,.xls,.csv">

            <div class="builtin-wordbanks" id="builtin-wordbanks">
                <div class="builtin-wordbank" data-wordbank="fruits"><i class="fas fa-apple-alt"></i> æ°´æœå•è¯</div>
                <div class="builtin-wordbank" data-wordbank="animals"><i class="fas fa-paw"></i> åŠ¨ç‰©å•è¯</div>
                <div class="builtin-wordbank" data-wordbank="school"><i class="fas fa-school"></i> å­¦æ ¡ç”¨å“</div>
                <div class="builtin-wordbank" data-wordbank="colors"><i class="fas fa-palette"></i> é¢œè‰²å•è¯</div>
                <div class="builtin-wordbank" data-wordbank="family"><i class="fas fa-home"></i> å®¶åº­æˆå‘˜</div>
                <div class="builtin-wordbank" data-wordbank="grade3"><i class="fas fa-child"></i> ä¸‰å¹´çº§å•è¯</div>
            </div>
        </div>

        <div class="word-panel" id="word-panel"></div>
    </div>

    <div class="volume-control" id="volume-control">
        <i class="fas fa-volume-up"></i>
    </div>

    <script>
// èœå•æŒ‰é’®ä¸æŠ½å±‰åŠŸèƒ½
const menuToggle = document.getElementById('menu-toggle');
const mobileDrawer = document.getElementById('mobile-drawer');
menuToggle.addEventListener('click',()=>{
  mobileDrawer.classList.toggle('open');
});

// ç§»åŠ¨ç«¯æ»‘å—/æŒ‰é’®/è¯åº“åŒæ­¥ä¸»æ§
const syncMobileControls = ()=>{
  const wcMain = document.getElementById('word-count');
  const wcDisplayMain = document.getElementById('word-count-display');
  const wcMobile = document.getElementById('word-count-m');
  const wcDisplayMobile = document.getElementById('word-count-display-m');
  wcMobile.value = wcMain.value;
  wcDisplayMobile.textContent = wcDisplayMain.textContent;
  wcMobile.addEventListener('input',()=>{
    wcMain.value = wcMobile.value;
    wcMain.dispatchEvent(new Event('input'));
  });
  wcMain.addEventListener('input',()=>{
    wcMobile.value = wcMain.value;
    wcDisplayMobile.textContent = wcMain.value;
  });
};
window.onload = syncMobileControls;

// ç§»åŠ¨ç«¯æŒ‰é’®äº‹ä»¶
const startBtnMain = document.getElementById('start-btn');
const startBtnMobile = document.getElementById('start-btn-m');
startBtnMobile.addEventListener('click',()=>{
  mobileDrawer.classList.remove('open');
  startBtnMain.click();
});
const importBtnMain = document.getElementById('import-btn');
const importBtnMobile = document.getElementById('import-btn-m');
const fileInputMain = document.getElementById('file-input');
const fileInputMobile = document.getElementById('file-input-m');
importBtnMobile.addEventListener('click',()=>{
  fileInputMobile.click();
});
fileInputMobile.addEventListener('change',(e)=>{
  fileInputMain.files = e.target.files;
  fileInputMain.dispatchEvent(new Event('change'));
});
// ç§»åŠ¨ç«¯è¯åº“ç‚¹å‡»äº‹ä»¶
const builtinWordBanksMain = document.getElementById('builtin-wordbanks');
const builtinWordBanksMobile = document.getElementById('builtin-wordbanks-m');
builtinWordBanksMobile.addEventListener('click', (e) => {
  if (e.target.classList.contains('builtin-wordbank')) {
    const wordbank = e.target.dataset.wordbank;
    const targetMain = builtinWordBanksMain.querySelector(`[data-wordbank='${wordbank}']`);
    targetMain.click();
    mobileDrawer.classList.remove('open');
  }
});


        
        // å†…ç½®å•è¯åº“
        const builtinWordBanks = {
            fruits: [
                ['apple', 'è‹¹æœ']ï¼Œ
                ['banana', 'é¦™è•‰'],
                ['orange', 'æ©™å­'],
                ['grape', 'è‘¡è„']ï¼Œ
                ['watermelon'ï¼Œ 'è¥¿ç“œ']ï¼Œ
                ['strawberry'ï¼Œ 'è‰è“']ï¼Œ
                ['pineapple'ï¼Œ 'è è'],
                ['pear', 'æ¢¨']ï¼Œ
                ['peach', 'æ¡ƒå­']ï¼Œ
                ['cherry', 'æ¨±æ¡ƒ'],
                ['mango', 'èŠ’æœ'],
                ['lemon', 'æŸ æª¬'],
                ['coconut'ï¼Œ 'æ¤°å­'],
                ['kiwi'ï¼Œ 'çŒ•çŒ´æ¡ƒ']ï¼Œ
                ['blueberry'ï¼Œ 'è“è“']
            ]ï¼Œ
            animals: [
                ['dog', 'ç‹—'],
                ['cat', 'çŒ«'],
                ['elephant'ï¼Œ 'å¤§è±¡'],
                ['lion', 'ç‹®å­']ï¼Œ
                ['tiger', 'è€è™'],
                ['monkey'ï¼Œ 'çŒ´å­']ï¼Œ
                ['panda'ï¼Œ 'ç†ŠçŒ«']ï¼Œ
                ['rabbit', 'å…”å­'],
                ['bear', 'ç†Š'],
                ['giraffe'ï¼Œ 'é•¿é¢ˆé¹¿']ï¼Œ
                ['zebra'ï¼Œ 'æ–‘é©¬']ï¼Œ
                ['kangaroo', 'è¢‹é¼ '],
                ['penguin', 'ä¼é¹…'],
                ['dolphin', 'æµ·è±š'],
                ['whale', 'é²¸é±¼']
            ]ï¼Œ
            school: [
                ['pen'ï¼Œ 'é’¢ç¬”']ï¼Œ
                ['pencil'ï¼Œ 'é“…ç¬”']ï¼Œ
                ['book'ï¼Œ 'ä¹¦'],
                ['notebook', 'ç¬”è®°æœ¬'],
                ['eraser', 'æ©¡çš®']ï¼Œ
                ['ruler', 'å°ºå­']ï¼Œ
                ['bag', 'ä¹¦åŒ…']ï¼Œ
                ['desk', 'è¯¾æ¡Œ'],
                ['chair', 'æ¤…å­'],
                ['blackboard', 'é»‘æ¿'],
                ['teacher', 'è€å¸ˆ']ï¼Œ
                ['student', 'å­¦ç”Ÿ'],
                ['classroom', 'æ•™å®¤'],
                ['homework', 'å®¶åº­ä½œä¸š'],
                ['test', 'è€ƒè¯•']
            ],
            colors: [
                ['red', 'çº¢è‰²'],
                ['blue', 'è“è‰²'],
                ['green', 'ç»¿è‰²'],
                ['yellow', 'é»„è‰²'],
                ['orange', 'æ©™è‰²'],
                ['purple', 'ç´«è‰²'],
                ['pink', 'ç²‰è‰²'],
                ['black', 'é»‘è‰²'],
                ['white', 'ç™½è‰²'],
                ['brown', 'æ£•è‰²'],
                ['gray', 'ç°è‰²'],
                ['gold', 'é‡‘è‰²'],
                ['silver', 'é“¶è‰²'],
                ['rainbow', 'å½©è™¹'],
                ['colorful', 'äº”å½©ç¼¤çº·çš„']
            ],
            family: [
                ['father', 'çˆ¸çˆ¸'],
                ['mother', 'å¦ˆå¦ˆ'],
                ['brother', 'å…„å¼Ÿ'],
                ['sister', 'å§å¦¹'],
                ['grandfather', 'çˆ·çˆ·'],
                ['grandmother', 'å¥¶å¥¶'],
                ['uncle', 'å”å”'],
                ['aunt', 'é˜¿å§¨'],
                ['cousin', 'å ‚å…„å¼Ÿå§å¦¹'],
                ['son', 'å„¿å­'],
                ['daughter', 'å¥³å„¿'],
                ['parents', 'çˆ¶æ¯'],
                ['grandparents', 'ç¥–çˆ¶æ¯'],
                ['family', 'å®¶åº­'],
                ['baby', 'å©´å„¿']
            ],
            grade3: [
                ["UK","è‹±å›½"],
                ["Canada","åŠ æ‹¿å¤§"],
                ["USA","ç¾å›½"],
                ["China","ä¸­å›½"],
                ["she","å¥¹"],
                ["student","å­¦ç”Ÿ"],
                ["pupil","å°å­¦ç”Ÿ"],
                ["he","ä»–"],
                ["teacher","è€å¸ˆ"],
                ["boy","ç”·å­©"],
                ["girl","å¥³å­©"],
                ["new","æ–°çš„"],
                ["friend","æœ‹å‹"],
                ["today","ä»Šå¤©"],
                ["father","çˆ¶äº²ï¼›çˆ¸çˆ¸"],
                ["dad","ï¼ˆå£è¯­ï¼‰çˆ¸çˆ¸ï¼›çˆ¹çˆ¹"],
                ["man","ç”·äºº"],
                ["woman","å¥³äºº"],
                ["mother","æ¯äº²ï¼›å¦ˆå¦ˆ"],
                ["sister","å§ï¼›å¦¹"],
                ["brother","å…„ï¼›å¼Ÿ"],
                ["grandmother","ï¼ˆå¤–ï¼‰ç¥–æ¯"],
                ["grandma","ï¼ˆå£è¯­ï¼‰(å¤–)ç¥–æ¯"],
                ["grandfather","(å¤–)ç¥–çˆ¶"],
                ["grandpa","ï¼ˆå£è¯­ï¼‰ï¼ˆå¤–ï¼‰ç¥–çˆ¶"],
                ["family","å®¶ï¼›å®¶åº­"],
                ["thin","ç˜¦çš„"],
                ["fat","èƒ–çš„"],
                ["tall","é«˜çš„"],
                ["short","çŸ®çš„ï¼›çŸ­çš„"],
                ["long","é•¿çš„"],
                ["small","å°çš„"],
                ["big","å¤§çš„"],
                ["giraffe","é•¿é¢ˆé¹¿"],
                ["so","è¿™ä¹ˆï¼›é‚£ä¹ˆ"],
                ["children","å­©å­çš„å¤æ•°"],
                ["child","å­©å­"],
                ["tail","å°¾å·´"],
                ["on","åœ¨â€¦â€¦ä¸Š"],
                ["in","åœ¨â€¦â€¦é‡Œ"],
                ["under","åœ¨â€¦â€¦ä¸‹é¢"],
                ["chair","æ¤…å­"],
                ["desk","æ¡Œå­"],
                ["cap","å¸½å­"],
                ["ball","çƒ"],
                ["car","å°æ±½è½¦"],
                ["boat","èˆ¹"],
                ["map","åœ°å›¾"],
                ["toy","ç©å…·"],
                ["box","ç›’ï¼›ç®±"],
                ["pear","æ¢¨"],
                ["apple","è‹¹æœ"],
                ["orange","æ©™å­"],
                ["banana","é¦™è•‰"],
                ["watermelon","è¥¿ç“œ"],
                ["strawberry","è‰è“"],
                ["grape","è‘¡è„"],
                ["buy","ä¹°"],
                ["fruit","æ°´æœ"],
                ["eleven","åä¸€"],
                ["twelve","åäºŒ"],
                ["thirteen","åä¸‰"],
                ["fourteen","åå››"],
                ["fifteen","åäº”"],
                ["sixteen","åå…­"],
                ["seventeen","åä¸ƒ"],
                ["eighteen","åå…«"],
                ["nineteen","åä¹"],
                ["twenty","äºŒå"],
                ["kite","é£ç­"],
                ["beautiful","ç¾ä¸½çš„"]
            ]
        };

        // éŸ³æ•ˆ - ä½¿ç”¨æœ¬åœ°æ–‡ä»¶
        const sounds = {
            flip: new Howl({ src: ['flip.mp3'] }),
            match: new Howl({ src: ['match.mp3'] }),
            mismatch: new Howl({ src: ['mismatch.mp3'] }),
            gameStart: new Howl({ src: ['game-start.mp3'] }),
            gameWin: new Howl({ src: ['game-over.mp3'] }),
            background: new Howl({
                src: ['background.mp3'],
                loop: true,
                volume: 0.3
            })
        };

        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            wordPairs: [],
            displayedWords: [],
            flippedCards: [],
            matchedPairs: 0,
            totalPairs: 10,
            startTime: null,
            timerInterval: null,
            isGameStarted: false,
            isGameReady: false,
            soundEnabled: true
        };

        // DOMå…ƒç´ 
        const elements = {
            title: document.getElementById('game-title'),
            wordCountInput: document.getElementById('word-count'),
            wordCountDisplay: document.getElementById('word-count-display'),
            importBtn: document.getElementById('import-btn'),
            fileInput: document.getElementById('file-input'),
            startBtn: document.getElementById('start-btn'),
            timer: document.getElementById('timer'),
            wordPanel: document.getElementById('word-panel'),
            builtinWordBanks: document.getElementById('builtin-wordbanks'),
            volumeControl: document.getElementById('volume-control')
        };

        // åˆå§‹åŒ–
        function init() {
            // æ’­æ”¾èƒŒæ™¯éŸ³ä¹
            if (gameState.soundEnabled) {
                sounds.background.play();
            }

            // æ ‡é¢˜ç‚¹å‡»äº‹ä»¶
            elements.title.addEventListener('click', () => {
                const newTitle = prompt('è¯·è¾“å…¥æ–°çš„æ¸¸æˆæ ‡é¢˜:', elements.title.textContent);
                if (newTitle) {
                    elements.title.textContent = newTitle;
                }
            });

            // å•è¯æ•°é‡æ»‘å—äº‹ä»¶
            elements.wordCountInput.addEventListener('input', () => {
                const count = elements.wordCountInput.value;
                elements.wordCountDisplay.textContent = count;
                gameState.totalPairs = parseInt(count);

                if (gameState.wordPairs.length > 0) {
                    prepareGame();
                }
            });

            // å¯¼å…¥è¯è¡¨æŒ‰é’®äº‹ä»¶
            elements.importBtn.addEventListener('click', () => {
                elements.fileInput.click();
            });

            // å¼€å§‹æ¸¸æˆæŒ‰é’®äº‹ä»¶
            elements.startBtn.addEventListener('click', startGame);

            // æ–‡ä»¶è¾“å…¥äº‹ä»¶
            elements.fileInput.addEventListener('change', handleFileUpload);

            // å†…ç½®è¯åº“ç‚¹å‡»äº‹ä»¶
            elements.builtinWordBanks.addEventListener('click', (e) => {
                if (e.target.classList.contains('builtin-wordbank')) {
                    const wordbank = e.target.dataset.wordbank;
                    loadBuiltinWordBank(wordbank);
                }
            });

            // éŸ³é‡æ§åˆ¶
            elements.volumeControl.addEventListener('click', toggleSound);

            // é»˜è®¤åŠ è½½æ°´æœå•è¯åº“
            loadBuiltinWordBank('grade3');
        }

        // åˆ‡æ¢éŸ³æ•ˆ
        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;

            if (gameState.soundEnabled) {
                Howler.mute(false);
                elements.volumeControl.innerHTML = '<i class="fas fa-volume-up"></i>';
                sounds.background.play();
            } else {
                Howler.mute(true);
                elements.volumeControl.innerHTML = '<i class="fas fa-volume-mute"></i>';
            }
        }

        // åŠ è½½å†…ç½®å•è¯åº“
        function loadBuiltinWordBank(wordbank) {
            if (builtinWordBanks[wordbank]) {
                gameState.wordPairs = builtinWordBanks[wordbank];
                prepareGame();

                if (gameState.soundEnabled) {
                    sounds.flip.play();
                }
            }
        }

        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });

                    // è¿‡æ»¤ç©ºè¡Œå’Œæ— æ•ˆæ•°æ®
                    const wordPairs = jsonData
                       .filter(row => row.length >= 2 && row[0] && row[1])
                       .map(row => [String(row[0]), String(row[1])]);

                    if (wordPairs.length > 0) {
                        gameState.wordPairs = wordPairs;
                        prepareGame();

                        if (gameState.soundEnabled) {
                            sounds.flip.play();
                        }
                    } else {
                        alert('å¯¼å…¥å¤±è´¥ï¼šExcelæ–‡ä»¶ä¸­æ²¡æœ‰æœ‰æ•ˆçš„å•è¯å¯¹');
                    }
                } catch (error) {
                    alert('è§£æExcelæ–‡ä»¶æ—¶å‡ºé”™: ' + error.message);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // å‡†å¤‡æ¸¸æˆ
    function prepareGame() {
        clearInterval(gameState.timerInterval);
        gameState.isGameStarted = false;
        gameState.isGameReady = false;
        gameState.matchedPairs = 0;
        gameState.flippedCards = [];
        elements.timer.textContent = 'è€—æ—¶: 0ç§’';

        // ç¡®ä¿å•è¯å¯¹æ•°ä¸è¶…è¿‡å¯ç”¨å•è¯å¯¹æ•°
        const availablePairs = gameState.wordPairs.length;
        const requestedPairs = Math.min(gameState.totalPairs, availablePairs);
        
        // æ›´æ–°æ»‘å—æœ€å¤§å€¼å’Œå½“å‰å€¼
        elements.wordCountInput.max = availablePairs;
        if (gameState.totalPairs > availablePairs) {
            gameState.totalPairs = availablePairs;
            elements.wordCountInput.value = availablePairs;
            elements.wordCountDisplay.textContent = availablePairs;
        }

        // é€‰æ‹©è¦æ˜¾ç¤ºçš„å•è¯å¯¹
        const selectedPairs = selectRandomPairs(gameState.wordPairs, gameState.totalPairs);
        gameState.displayedWords = createWordCards(selectedPairs);

        // æ¸²æŸ“å•è¯é¢æ¿
        renderWordPanel();

        gameState.isGameReady = true;
        elements.startBtn.innerHTML = '<i class="fas fa-play"></i> å¼€å§‹æ¸¸æˆ';
    }

    // ä»è¯è¡¨ä¸­éšæœºé€‰æ‹©æŒ‡å®šæ•°é‡çš„å•è¯å¯¹
    function selectRandomPairs(pairs, count) {
        if (!pairs || pairs.length === 0) return [];
        
        // ç¡®ä¿è¯·æ±‚çš„æ•°é‡ä¸è¶…è¿‡å¯ç”¨æ•°é‡
        const maxPairs = Math.min(count, pairs.length);
        
        // å¤åˆ¶æ•°ç»„ä»¥é¿å…ä¿®æ”¹åŸæ•°ç»„
        const shuffled = [...pairs].sort(() => 0.5 - Math.random());
        return shuffled.slice(0, maxPairs);
    }

        // åˆ›å»ºå•è¯å¡ç‰‡æ•°ç»„
        function createWordCards(pairs) {
            const cards = [];

            pairs.forEach(pair => {
                // æ¯å¯¹å•è¯åˆ›å»ºä¸¤å¼ å¡ç‰‡
                cards.push({
                    text: pair[0],
                    pairId: pair.join('|'),
                    isFlipped: false,
                    isMatched: false
                });

                cards.push({
                    text: pair[1],
                    pairId: pair.join('|'),
                    isFlipped: false,
                    isMatched: false
                });
            });

            // æ‰“ä¹±å¡ç‰‡é¡ºåº
            return cards.sort(() => 0.5 - Math.random());
        }

        // æ¸²æŸ“å•è¯é¢æ¿
        function renderWordPanel() {
            elements.wordPanel.innerHTML = '';

            gameState.displayedWords.forEach((word, index) => {
                if (word.isMatched) return; // å·²åŒ¹é…çš„å¡ç‰‡ä¸æ¸²æŸ“

                const card = document.createElement('div');
                card.className = 'word-card';
                if (word.isFlipped) card.classList.add('flipped');

                if (!word.isFlipped) {
                    card.textContent = word.text;
                }

                card.dataset.index = index;
                card.addEventListener('click', handleCardClick);

                elements.wordPanel.appendChild(card);
            });
        }

        // å¤„ç†å¡ç‰‡ç‚¹å‡»äº‹ä»¶
        function handleCardClick(event) {
            if (!gameState.isGameStarted || !gameState.isGameReady) return;

            const index = parseInt(event.currentTarget.dataset.index);
            const card = gameState.displayedWords[index];

            // å¦‚æœå¡ç‰‡å·²ç»åŒ¹é…æˆ–å·²ç»ç¿»å¼€ï¼Œåˆ™å¿½ç•¥ç‚¹å‡»
            if (card.isMatched || card.isFlipped || gameState.flippedCards.length >= 2) {
                return;
            }

            // æ’­æ”¾ç¿»ç‰ŒéŸ³æ•ˆ
            if (gameState.soundEnabled) {
                sounds.flip.play();
            }

            // ç¿»å¼€å¡ç‰‡
            card.isFlipped = true;
            gameState.flippedCards.push(index);

            // é‡æ–°æ¸²æŸ“é¢æ¿
            renderWordPanel();

            // æ£€æŸ¥æ˜¯å¦åŒ¹é…
            if (gameState.flippedCards.length === 2) {
                checkForMatch();
            }
        }

        // æ£€æŸ¥ç¿»å¼€çš„å¡ç‰‡æ˜¯å¦åŒ¹é…
        function checkForMatch() {
            const [index1, index2] = gameState.flippedCards;
            const card1 = gameState.displayedWords[index1];
            const card2 = gameState.displayedWords[index2];

            if (card1.pairId === card2.pairId) {
                // åŒ¹é…æˆåŠŸ
                if (gameState.soundEnabled) {
                    sounds.match.play();
                }

                card1.isMatched = true;
                card2.isMatched = true;
                gameState.matchedPairs++;

                // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
                if (gameState.matchedPairs === gameState.totalPairs) {
                    endGame();
                }

                gameState.flippedCards = [];
                // é‡æ–°æ¸²æŸ“é¢æ¿ï¼ŒåŒ¹é…çš„å¡ç‰‡ä¼šæ¶ˆå¤±
                setTimeout(() => {
                    renderWordPanel();
                }, 300);
            } else {
                // åŒ¹é…å¤±è´¥
                if (gameState.soundEnabled) {
                    sounds.mismatch.play();
                }

                // åŒ¹é…å¤±è´¥ï¼Œç¿»å›å»
                setTimeout(() => {
                    card1.isFlipped = false;
                    card2.isFlipped = false;
                    gameState.flippedCards = [];
                    renderWordPanel();
                }, 1000);
            }
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (!gameState.isGameReady) {
                alert('è¯·å…ˆé€‰æ‹©å•è¯åº“æˆ–å¯¼å…¥è¯è¡¨ï¼');
                return;
            }

            if (gameState.isGameStarted) {
                // é‡æ–°å¼€å§‹æ¸¸æˆ
                prepareGame();
                return;
            }

            // æ’­æ”¾æ¸¸æˆå¼€å§‹éŸ³æ•ˆ
            if (gameState.soundEnabled) {
                sounds.gameStart.play();
            }

            gameState.isGameStarted = true;
            gameState.startTime = new Date();
            elements.startBtn.innerHTML = '<i class="fas fa-redo"></i> é‡æ–°å¼€å§‹';

            // å¯åŠ¨è®¡æ—¶å™¨
            gameState.timerInterval = setInterval(updateTimer, 1000);

            // å°†æ‰€æœ‰å¡ç‰‡ç¿»é¢
            gameState.displayedWords.forEach(card => {
                card.isFlipped = true;
            });
            renderWordPanel();

            // 3ç§’åç¿»å›å»
            setTimeout(() => {
                gameState.displayedWords.forEach(card => {
                    card.isFlipped = false;
                });
                renderWordPanel();
            }, 3000);
        }

        // æ›´æ–°è®¡æ—¶å™¨
        function updateTimer() {
            const now = new Date();
            const elapsed = Math.floor((now - gameState.startTime) / 1000);
            elements.timer.textContent = `è€—æ—¶: ${elapsed}ç§’`;
        }

        // ç»“æŸæ¸¸æˆ
        function endGame() {
            clearInterval(gameState.timerInterval);

            const now = new Date();
            const elapsed = Math.floor((now - gameState.startTime) / 1000);

            // æ’­æ”¾èƒœåˆ©éŸ³æ•ˆ
            if (gameState.soundEnabled) {
                sounds.gameWin.play();
            }

            // åº†ç¥æ•ˆæœ
            confetti({
                particleCount: 200,
                spread: 90,
                origin: { y: 0.6 },
                colors: ['#ff7473', '#ffc952', '#34314c', '#47b8e0']
            });

            setTimeout(() => {
                alert(`ğŸ‰ æ­å–œä½ å®Œæˆäº†æ¸¸æˆï¼\nç”¨æ—¶: ${elapsed}ç§’`);
            }, 800);
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        init();
    </script>
</body>

</html>
